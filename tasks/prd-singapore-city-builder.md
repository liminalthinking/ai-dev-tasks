# Product Requirements Document: Singapore City Builder

## 1. Introduction/Overview

This document outlines the requirements for creating a digital adaptation of the "Singapore City Builder" card game. The goal is to develop a faithful, single-player version of the game using the Phaser 3 framework. The game will be a browser-based experience, accessible on both desktop and mobile devices, targeted at casual gamers. The core focus of this initial version is to implement the complete gameplay loop without extra features like animations, sound, or game-saving functionality.

## 2. Game Setup

### 2.1. Starting Cards
The player's deck is initialized with three cards:
*   2x Kampung (Base card: 0 cost / 3 evolve cost / 1 resource / 0 pressure / 0 points)
    *   Can evolve into HDB Block (2 resources / 0 pressure / 2 points)
*   1x Swamp (Base card: 0 cost / 4 evolve cost / 0 resources / 1 pressure / 0 points)
    *   Can evolve into Kallang River (1 resource / 0 pressure / 3 points)

### 2.2. Market Cards
Each market card category has 4 copies available and can be evolved:
*   Police Station → City Hall
    *   Base: 2 cost / 3 evolve cost / 1 resource / 1 pressure / 1 point
    *   Evolved: 2 resources / 0 pressure / 3 points
*   Provision Shop → Shopping Mall
    *   Base: 1 cost / 4 evolve cost / 1 resource / 0 pressure / 1 point
    *   Evolved: 3 resources / 1 pressure / 2 points
*   Street Food Stall → Hawker Centre
    *   Base: 1 cost / 2 evolve cost / 2 resources / 1 pressure / 0 points
    *   Evolved: 3 resources / 1 pressure / 4 points
*   Trishaw Hub → Bus Interchange
    *   Base: 3 cost / 5 evolve cost / 0 resources / 1 pressure / 2 points
    *   Evolved: 1 resource / 0 pressure / 5 points
*   Wet Market → Supermarket
    *   Base: 2 cost / 3 evolve cost / 1 resource / 1 pressure / 1 point
    *   Evolved: 2 resources / 1 pressure / 3 points
*   Classroom → University
    *   Base: 4 cost / 6 evolve cost / 1 resource / 0 pressure / 2 points
    *   Evolved: 2 resources / 0 pressure / 6 points

## 3. Goals

*   To create a faithful digital version of the "Singapore City Builder" card game rules.
*   To deliver a complete and playable core game loop encompassing all three game phases (Play Cards, Build, Evolve).
*   To ensure the game is accessible and playable for casual gamers on both desktop and mobile web browsers.
*   To provide a clear and functional user interface that allows players to easily understand the game state.

## 3. User Stories

*   **As a player,** I want to see all the main game areas (my deck, played cards, the market, discard pile, and a HUD) on a single screen so I can track the game state at a glance.
*   **As a player,** I want to click on the deck, which shows the back of a card, to draw and play the next card in sequence.
*   **As a player,** I want the HUD to instantly update with the Resource and pressure generated by each card I play.
*   **As a player,** I want to hover my mouse over a card to see a larger, more detailed view of it.
*   **As a player,** when the game ends (after 12 turns or if I bust), I want to see a summary screen that tells me if my nation survived and shows my final building point score.
*   **As a player,** after a game is over, I want a button to start a new game immediately.
*   **As a player,** I want to be able to click an "End Phase" button to manually advance to the next phase of my turn (e.g., from Build Phase to Evolve Phase).

## 4. Functional Requirements

### 4.1. Game Engine and Platform
1.  The game must be built using the **Phaser 3** framework.
2.  The game must be playable in modern web browsers on both **desktop and mobile** devices.

### 4.2. Game Structure & Scenes
1.  The game will be structured with a main background scene and multiple, independent scenes layered on top for different UI components.
2.  The following scenes must be created:
    *   `BackgroundScene`: A static background image.
    *   `MarketScene`: Displays the cards available for purchase.
        *   Cards should be non-clickable but visible during non-Build phases
        *   Cards should be hoverable to show details (future enhancement)
    *   `DeckScene`: Displays the player's draw deck (showing the card back). This is the primary interaction point during the "Play Cards" phase.
    *   `PlayedCardsScene`: Displays the cards that have been played in the current turn.
    *   `DiscardPileScene`: Displays the discarded cards.
    *   `HUDScene`: Displays key game state information:
        *   Current turn Resource (initialized at 0)
        *   Current turn pressure, displayed as "X/5" where X is current pressure (initialized at 0/5)
        *   Total building points from all cards in the deck.
        *   Current turn number (1-12).
    *   `MessagesScene`: Displays contextual messages to the player (e.g., "Build Phase") and contains the "End Phase" button.
        *   The "Build" and "Evolve!" buttons should be grayed out when the player has insufficient Resource
3.  All scenes will be visible at all times, but only the relevant scene will be interactive based on the current game phase.

### 4.3. Gameplay Loop (12 Turns)
The game progresses through three main phases per turn, followed by an end-of-turn phase. The player clicks the "End Phase" button in the `MessagesScene` to advance from one phase to the next.

1.  **Play Cards Phase:**
    *   If this is not turn 1, the turn counter advances in the `HUDScene`.
    *   The `MessagesScene` will display "Play Cards Phase".
    *   The player clicks on the `DeckScene` to draw one card at a time.
    *   The drawn card is revealed in the `PlayedCardsScene`.
    *   The `Resource` and `Pressure` from the played card are added to the turn's total, displayed in the `HUDScene`.
    *   The player can continue drawing cards until they choose to stop (by clicking "End Phase") or their total pressure exceeds the limit (bust).
2.  **Build Phase:** 
    *   The `MessagesScene` will display "Build Phase".
    *   The player uses the `Resource` gathered in the Play Cards phase to build new cards from the `MarketScene`.
    *   The `MarketScene` manages six fixed card slots and their card counts:
        *   Each slot is dedicated to a specific card category: Provision Shop, Classroom, Wet Market, Police Station, Trishaw Hub, and Street Food Stall
        *   Each category starts with a stack of 4 identical base cards available for building
        *   The positions of these 6 card categories are fixed throughout the game
        *   When a base card is evolved, it becomes a different card (e.g., Classroom → University) and does NOT replenish the base card count
        *   A slot becomes empty only when all 4 base cards of that category have been built
    *   When the player clicks to build a card from the market (and has enough `Resource`):
        *   The built card is added to the `DiscardPileScene`
        *   The `HUDScene` is updated to show the remaining `Resource`
        *   The `MarketScene` updates the base card count for that category (decrements by 1)
        *   If there are remaining base cards in that category's stack, a new card of the same type is immediately displayed in the same slot
        *   If that was the last base card of that category (count reaches 0), the slot remains empty for the rest of the game
3.  **Evolve Phase:** 
    *   The `MessagesScene` will display "Evolve Phase" and show an "Evolve!" button.
    *   The player can evolve cards that meet ALL of the following conditions:
        *   The card must be in the `PlayedCardsScene` (played this turn)
        *   The card must have an evolve cost property (base cards only; evolved cards cannot be evolved again)
        *   The player must have enough `Resource` to pay the evolve cost
    *   To evolve a card:
        1. The player clicks on an eligible card in the `PlayedCardsScene`
        2. The player clicks the "Evolve!" button in the `MessagesScene`
        3. The following updates occur immediately:
            *   The base card is replaced with its evolved version in the `DiscardPileScene`
            *   The `HUDScene` deducts the evolve cost from available `Resource`
            *   The building points in the `HUDScene` are updated to reflect the evolved card's points
    *   The player can evolve multiple cards as long as they meet the conditions and have sufficient `Resource`

4.  **End of Turn Phase:**
    *   The `MessagesScene` will display "End of Turn".
    *   A pressure card (1 pressure) is added to the `DiscardPileScene`.
    *   When the player clicks the "End Phase" button:
        *   If this is turn 12:
            *   The game ends
            *   The `MessagesScene` displays "Game Ends! You have helped Singapore survive through 12 years of development without its pressure exceeding the maximum!"
            *   The "End Phase" button is replaced with a "Play Again" button
        *   Otherwise:
            *   All played cards and the discard pile are shuffled together with the existing deck to form the player's new deck
            *   The `HUDScene` resets Resource and Pressure to 0
            *   The game proceeds to the Play Cards Phase of the next turn

### 4.4. Game End
1.  The game ends in one of two ways:
    *   The player completes turn 12 successfully (survival)
    *   The player busts by exceeding the pressure limit at any point (failure)
2.  The `MessagesScene` will:
    *   Display the appropriate message:
        *   For survival: "Game Ends! You have helped Singapore survive through 12 years of development without its pressure exceeding the maximum!"
        *   For failure: A message indicating the nation did not survive due to excessive pressure
    *   Replace the "End Phase" button with a "Play Again" button that resets the game and starts a new session
3.  The final total of building points remains displayed in the `HUDScene`.

## 5. Non-Goals (Out of Scope for MVP)

*   **Animations and Sound:** No card animations (e.g., sliding, fading) or sound effects will be implemented in this version. Card appearances will be instantaneous.
*   **Game Saving:** The game state will not be saved. Each session is standalone.
*   **Tutorial:** An interactive tutorial is not required for the initial release.
*   **Player Accounts/Profiles:** No user login or profile system.

## 6. Design & Asset Requirements

A simple, clean, and functional UI is prioritized. The focus is on clarity and playability over complex aesthetics.

### 6.1. Asset List
The following assets are required. Please place them in an `/assets` directory in the project root, organized as follows:

*   **/assets/images/background.png**: The main background for the game.
*   **/assets/images/card_back.png**: The image for the back of the cards.
*   **/assets/images/cards/**: This directory will contain the individual images for each card, named exactly as the card name in lowercase with hyphens:
    *   Starting Cards: `kampung.png`, `swamp.png`, `hdb-block.png`, `kallang-river.png`
    *   Market Cards (base): `provision-shop.png`, `classroom.png`, `wet-market.png`, `police-station.png`, `trishaw-hub.png`, `street-food-stall.png`
    *   Market Cards (evolved): `shopping-mall.png`, `university.png`, `supermarket.png`, `city-hall.png`, `bus-interchange.png`, `hawker-centre.png`
    *   Pressure Card: `pressure.png`
    *   **/assets/icons/**: This directory will contain icons for:
    *   Resource
    *   Pressure
    *   Building Points

### 6.2. UI Layout
The game layout should follow the provided UI mockup. The screen is divided into several areas, each managed by its own scene:
*   **Top:** `HUDScene`
*   **Middle Left:** `MarketScene`
*   **Middle Right:** `MessagesScene`
*   **Bottom Left:** `DeckScene`
*   **Bottom Middle:** `PlayedCardScene`
*   **Bottom Right:** `DiscardPileScene`

## 7. Technical Considerations

### 7.1. Card Data Management

The game needs a robust card property management system to handle all card interactions and calculations:

```javascript
/**
 * @typedef {Object} CardProperties
 * @property {string} name - Exact name of the card (e.g., "Classroom")
 * @property {string} type - Card category: "starting", "market", or "pressure"
 * @property {number} cost - Resource cost to build (0 for starting cards)
 * @property {number} evolveCost - Resource cost to evolve (0 if card cannot evolve)
 * @property {number} resource - Resource produced when played
 * @property {number} pressure - Pressure produced when played
 * @property {number} points - Building points
 * @property {string} evolvesTo - Name of evolved version (empty string if cannot evolve)
 * @property {string} imageAsset - Filename of card image (e.g., "classroom.png")
 */

// Example card data structure:
const cardData = {
    // Starting Cards
    "Kampung": {
        name: "Kampung",
        type: "starting",
        cost: 0,
        evolveCost: 3,
        resource: 1,
        pressure: 0,
        points: 0,
        evolvesTo: "HDB Block",
        imageAsset: "kampung.png"
    },
    // Market Cards
    "Classroom": {
        name: "Classroom",
        type: "market",
        cost: 4,
        evolveCost: 6,
        resource: 1,
        pressure: 0,
        points: 2,
        evolvesTo: "University",
        imageAsset: "classroom.png"
    },
    // Evolved Cards (evolveCost is 0 and evolvesTo is empty as they cannot evolve further)
    "University": {
        name: "University",
        type: "market",
        cost: 0,
        evolveCost: 0,
        resource: 2,
        pressure: 0,
        points: 6,
        evolvesTo: "",
        imageAsset: "university.png"
    }
}
}
```

This data structure will be used to:
1. Initialize the market with correct card properties
2. Validate if a player can afford to build/evolve a card
3. Calculate resource and pressure generation when cards are played
4. Track and update building points
5. Manage card evolution by referencing the `evolvesTo` property

### 7.2. Error Handling

1. **Asset Loading**
   - The game should preload all assets during initialization
   - If any critical assets fail to load:
     - Display a user-friendly error message in the `MessagesScene`
     - Show a "Retry" button that attempts to reload failed assets
     - If retry fails, suggest refreshing the browser
   - For non-critical assets (e.g., specific card images):
     - Use a default "card unavailable" placeholder image
     - Log the error for debugging
     - Allow the game to continue if possible

2. **Data Validation**
   - Validate all card data against the `CardProperties` schema
   - Log any inconsistencies (missing properties, invalid values)
   - Prevent cards with invalid data from being added to the game

3. **State Management**
   - Implement guards against invalid state transitions
   - Prevent actions during incorrect phases
   - Validate all resource/pressure calculations
   - Add console warnings for development debugging

### 7.3. Phased Implementation Plan
To ensure a lean and structured development process, the project should be built in phases:

*   **Phase 1: Project Setup & Scene Loading**
    *   Set up a new Phaser 3 project.
    *   Create all required scene files (`BackgroundScene`, `MarketScene`, `DeckScene`, `PlayedCardsScene`, `DiscardPileScene`, `HUDScene`, `MessagesScene`).
    *   Implement the basic logic to load and layer all scenes correctly on top of the background. Ensure they are laid out according to the UI mockup.
    *   Implement the turn sequence logic (tracking turns 1 through 12).

*   **Phase 2: Core Gameplay - The 3 Phases**
    *   Implement the full logic for the "Play Cards" phase.
    *   Implement the "Build" and "Evolve" phases.
    *   Manage card state between the deck, played area, and discard pile.

*   **Phase 3: Game End & Scoring**
    *   Implement the pressure limit (bust) condition.
    *   Calculate the final building point score.
    *   Create the game-end screen with the survival status, score, and "Play Again" button.

### 7.2. Responsiveness
The game layout must adapt to different screen sizes to be playable on both desktop and mobile. Phaser's scaling and camera features should be used to achieve this.

## 8. Success Metrics

*   The game is fully playable from start to finish without bugs in the core loop.
*   The game correctly implements and calculates all game mechanics as per the "Singapore City Builder" rules (Resource generation, pressure, points).
*   All functional requirements listed in section 4 are met.

## 9. Open Questions

*   What are the precise dimensions (width x height in pixels) for the card images?
*   Are there any specific fonts or color codes to be used for the UI text?
